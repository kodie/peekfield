{"version":3,"file":"vanishing-fields.js","sources":["../src/vanishing-fields.js"],"sourcesContent":["/*!\n  vanishing-fields v0.1.0 (https://github.com/kodie/vanishing-fields)\n  by Kodie Grantham (https://kodieg.com)\n*/\n\nvar vanishingFields = (options, fields) => {\n  if (!options) options = {}\n  if (!fields) fields = '[data-vanishing-field]:not(data-vanishing-field-ignore)'\n\n  if (typeof fields === 'string') {\n    fields = document.querySelectorAll(fields)\n  } else if (fields instanceof HTMLElement) {\n    fields = [fields]\n  }\n\n  if (vanishingFields.fieldCount === undefined) {\n    vanishingFields.fieldCount = 0\n    vanishingFields.lastTabIndex = -1\n  } else {\n    if (!options.startingTabIndex) {\n      options.startingTabIndex = (vanishingFields.lastTabIndex + 1)\n    }\n  }\n\n  for (let i = 0; i < fields.length; i++) {\n    (function (field) {\n      const identifier = field.getAttribute('data-vanishing-field')\n\n      if (!identifier.length) {\n        console.warn(field, 'data-vanishing-field attribute needs to be set to a string')\n        return false\n      }\n\n      vanishingFields.fieldCount++\n\n      field.label = document.querySelector('[data-vanishing-field-for=\"' + identifier + '\"]')\n      field.inputs = field.querySelectorAll('input:not(data-vanishing-field-ignore),textarea:not(data-vanishing-field-ignore),select:not(data-vanishing-field-ignore)')\n\n      field.options = Object.assign({\n        applyStyles: true,\n        closeOnFocusOut: true,\n        devMode: false,\n        display: null,\n        onClose: null,\n        onOpen: null,\n        opened: false,\n        options: {},\n        placeholder: null,\n        startingTabIndex: 0\n      }, options || {})\n\n      if (field.options.options[identifier]) {\n        field.options = Object.assign(field.options, field.options.options[identifier])\n      }\n\n      delete field.options.options\n\n      const applyStylesAttr = field.getAttribute('data-vanishing-field-apply-styles')\n      if (applyStylesAttr) field.options.applyStyles = (applyStylesAttr !== 'false')\n\n      const closeOnFocusOutAttr = field.getAttribute('data-vanishing-field-close-on-focus-out')\n      if (closeOnFocusOutAttr) field.options.closeOnFocusOut = (closeOnFocusOutAttr !== 'false')\n\n      if (field.label) {\n        field.label.display = field.label.getAttribute('data-vanishing-field-display') || field.options.display\n        field.label.placeholder = field.label.getAttribute('data-vanishing-field-placeholder') || field.options.placeholder\n\n        if (field.options.startingTabIndex !== false && !field.label.getAttribute('tabindex')) {\n          field.label.setAttribute('tabindex', field.options.startingTabIndex + i)\n        }\n      }\n\n      if (field.options.startingTabIndex !== false && !field.getAttribute('tabindex')) {\n        field.setAttribute('tabindex', field.options.startingTabIndex + i)\n        vanishingFields.lastTabIndex = (field.options.startingTabIndex + i)\n      }\n\n      field.open = function (triggerEvents) {\n        if (field.options.devMode) console.log(identifier, 'open')\n        if (field.opened === true) return field\n\n        field.opened = true\n\n        if (field.options.applyStyles) {\n          field.style['display'] = null\n          field.style['visibility'] = null\n\n          if (field.label) {\n            field.label.style['display'] = 'none'\n            field.label.style['visibility'] = 'hidden'\n          }\n        }\n\n        field.classList.toggle('open', field.opened)\n        if (field.label) field.label.classList.toggle('open', field.opened)\n\n        if (field.inputs.length) {\n          field.inputs[0].focus()\n        } else {\n          field.focus()\n        }\n\n        if (triggerEvents !== false) {\n          field.dispatchEvent(new Event('open', { bubbles: true }))\n        }\n\n        return field\n      }\n\n      field.close = function (triggerEvents) {\n        if (field.options.devMode) console.log(identifier, 'close')\n        if (field.opened === false) return field\n\n        field.opened = false\n        field.values = field.getInputValues()\n\n        if (field.options.applyStyles) {\n          field.style['display'] = 'none'\n          field.style['visibility'] = 'hidden'\n\n          if (field.label) {\n            field.label.style['display'] = null\n            field.label.style['visibility'] = null\n          }\n        }\n\n        const inputValues = Object.values(field.values).filter(function (v) { return v && v.length })\n\n        field.changed = false\n        field.empty = !inputValues.length\n\n        for (const name in field.values) {\n          if (field.values.hasOwnProperty(name)) {\n            if (Array.isArray(field.values[name])) {\n              if (field.values[name].sort().join(',') !== field.originalValues[name].sort().join(',')) {\n                field.changed = true\n                break\n              }\n            } else {\n              if (field.values[name] !== field.originalValues[name]) {\n                field.changed = true\n                break\n              }\n            }\n          }\n        }\n\n        field.classList.toggle('open', field.opened)\n        field.classList.toggle('changed', field.changed)\n        field.classList.toggle('empty', field.empty)\n\n        if (field.label) {\n          field.label.classList.toggle('open', field.opened)\n          field.label.classList.toggle('changed', field.changed)\n          field.label.classList.toggle('empty', field.empty)\n\n          if (field.empty) {\n            if (field.label.placeholder) {\n              if (typeof field.label.placeholder === 'function') {\n                field.label.innerHTML = field.label.placeholder(field)\n              } else {\n                field.label.innerHTML = field.label.placeholder\n              }\n            } else {\n              field.label.innerHTML = ''\n            }\n          } else {\n            if (field.label.display) {\n              if (typeof field.label.display === 'function') {\n                field.label.innerHTML = field.label.display(field)\n              } else {\n                field.label.innerHTML = field.label.display.replace(/{(.+?)}/g, function (match, name) {\n                  const split = name.split('|')\n                  let value = field.values[split[0]] || split[1] || match\n                  if (Array.isArray(value)) value = value.join(split[2] || ',')\n                  return value\n                })\n              }\n            } else {\n              field.label.innerHTML = inputValues.join(' ')\n            }\n          }\n        }\n\n        if (triggerEvents !== false) {\n          field.dispatchEvent(new Event('close', { bubbles: true }))\n        }\n\n        return field\n      }\n\n      field.toggle = (open, triggerEvents) => {\n        if (field.options.devMode) console.log(identifier, 'toggle')\n\n        if (open === true || (open === undefined && !field.opened)) {\n          field.open(triggerEvents)\n        } else if (open === false || (open === undefined && field.opened)) {\n          field.close(triggerEvents)\n        }\n\n        return field\n      }\n\n      field.getInputValues = () => {\n        let values = {}\n\n        if (field.inputs.length) {\n          values = Array.from(field.inputs).reduce((values, input) => {\n            let name = input.name || input.id\n            let value = input.value\n            const tagName = input.tagName.toLowerCase()\n\n            if (name.slice(-2) === '[]') {\n              name = name.substr(0, name.length - 2)\n              value = [value]\n            }\n\n            if (tagName === 'select' && input.multiple) {\n              value = Array.from(input.selectedOptions).map(function (option) {\n                return option.value\n              })\n            }\n\n            if (input.type === 'file') {\n              value = Array.from(input.files).map(function (file) {\n                return file.name\n              })\n            }\n\n            if ((input.type === 'checkbox' || input.type === 'radio') && !input.checked) {\n              if (values[name]) return values\n              value = Array.isArray(value) ? [] : null\n            }\n\n            if (values[name]) {\n              if (Array.isArray(values[name])) {\n                value = values[name].concat([value])\n              } else {\n                value = [values[name], value]\n              }\n\n              value = value.filter((v) => v && v.length)\n            }\n\n            values[name] = value\n            return values\n          }, {})\n        }\n\n        if (field.options.devMode) console.log(identifier, 'input values:', values)\n\n        return values\n      }\n\n      if (field.label) {\n        field.label.addEventListener('click', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'label click')\n          field.open()\n        })\n\n        field.label.addEventListener('focusin', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'label focusin')\n          field.open()\n        })\n      }\n\n      field.addEventListener('focusout', function (e) {\n        if (field.contains(e.relatedTarget) || field.contains(document.activeElement)) return\n        e.stopImmediatePropagation()\n        if (field.options.devMode) console.log(identifier, 'focusout')\n        if (field.options.closeOnFocusOut) field.close()\n      })\n\n      if (field.options.onOpen) {\n        field.addEventListener('open', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'onOpen')\n          field.options.onOpen(e, field)\n        })\n      }\n\n      if (field.options.onClose) {\n        field.addEventListener('close', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'onClose')\n          field.options.onClose(e, field)\n        })\n      }\n\n      const openElements = document.querySelectorAll('[data-vanishing-field-open=\"' + identifier + '\"]')\n      for (let j1 = 0; j1 < openElements.length; j1++) {\n        (function (openElement) {\n          openElement.addEventListener('click', function (e) {\n            if (e.target !== e.currentTarget) return\n            e.stopImmediatePropagation()\n            if (field.options.devMode) console.log(identifier, 'openElement click', openElement)\n            field.open()\n          })\n        })(openElements[j1])\n      }\n\n      const closeElements = document.querySelectorAll('[data-vanishing-field-close=\"' + identifier + '\"]')\n      for (let j2 = 0; j2 < closeElements.length; j2++) {\n        (function (closeElement) {\n          closeElement.addEventListener('click', function (e) {\n            if (e.target !== e.currentTarget) return\n            e.stopImmediatePropagation()\n            if (field.options.devMode) console.log(identifier, 'closeElement click', closeElement)\n            field.close()\n          })\n        })(closeElements[j2])\n      }\n\n      const toggleElements = document.querySelectorAll('[data-vanishing-field-toggle=\"' + identifier + '\"]')\n      for (let j3 = 0; j3 < toggleElements.length; j3++) {\n        (function (toggleElement) {\n          toggleElement.addEventListener('click', function (e) {\n            if (e.target !== e.currentTarget) return\n            e.stopImmediatePropagation()\n            if (field.options.devMode) console.log(identifier, 'toggleElement click', toggleElement)\n            field.toggle()\n          })\n        })(toggleElements[j3])\n      }\n\n      for (let j4 = 0; j4 < field.inputs.length; j4++) {\n        (function (input) {\n          if (input.id) {\n            const inputLabels = document.querySelectorAll('label[for=' + input.id + ']')\n            for (let j4i = 0; j4i < inputLabels.length; j4i++) {\n              (function (inputLabel) {\n                inputLabel.addEventListener('click', function (e) {\n                  if (field.options.devMode) console.log(identifier, 'input label click', inputLabel, input)\n                  field.open()\n                })\n              })(inputLabels[j4i])\n            }\n          }\n        })(field.inputs[j4])\n      }\n\n      field.values = field.getInputValues()\n      field.originalValues = Object.assign({}, field.values)\n\n      const inputValues = Object.values(field.values).filter(function (v) { return v && v.length })\n\n      field.changed = false\n      field.empty = !inputValues.length\n\n      field.classList.toggle('empty', field.empty)\n      if (field.label) field.label.classList.toggle('empty', field.empty)\n\n      if (field.classList.contains('open') || field.options.opened) {\n        field.open(false)\n      } else {\n        field.close(false)\n      }\n    })(fields[i])\n  }\n\n  return fields\n}\n\nexport default vanishingFields\n"],"names":["vanishingFields","options","fields","document","querySelectorAll","HTMLElement","fieldCount","undefined","lastTabIndex","startingTabIndex","i","field","identifier","getAttribute","length","console","warn","label","querySelector","inputs","Object","assign","applyStyles","closeOnFocusOut","devMode","display","onClose","onOpen","opened","placeholder","applyStylesAttr","closeOnFocusOutAttr","setAttribute","open","triggerEvents","log","style","classList","toggle","focus","dispatchEvent","Event","bubbles","close","values","getInputValues","inputValues","filter","v","changed","empty","name","hasOwnProperty","Array","isArray","sort","join","originalValues","innerHTML","replace","match","split","value","from","reduce","input","id","tagName","toLowerCase","slice","substr","multiple","selectedOptions","map","option","type","files","file","checked","concat","addEventListener","e","stopImmediatePropagation","contains","relatedTarget","activeElement","openElements","j1","openElement","target","currentTarget","closeElements","j2","closeElement","toggleElements","j3","toggleElement","j4","inputLabels","j4i","inputLabel"],"mappings":"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"}