!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).vanishingFields=t()}(this,function(){"use strict";
/*!
    vanishing-fields v0.1.0 (https://github.com/kodie/vanishing-fields)
    by Kodie Grantham (https://kodieg.com)
  */return function c(u,e){u=u||{},"string"==typeof(e=e||"[data-vanishing-field]:not(data-vanishing-field-ignore)")?e=document.querySelectorAll(e):e instanceof HTMLElement&&(e=[e]),void 0===c.fieldCount?(c.fieldCount=0,c.lastTabIndex=-1):u.startingTabIndex||(u.startingTabIndex=c.lastTabIndex+1);for(var t=function(p){!function(o){var l=o.getAttribute("data-vanishing-field");if(l.length){c.fieldCount++,o.label=document.querySelector('[data-vanishing-field-for="'+l+'"]'),o.inputs=o.querySelectorAll("input:not(data-vanishing-field-ignore),textarea:not(data-vanishing-field-ignore),select:not(data-vanishing-field-ignore)"),o.options=Object.assign({applyStyles:!0,closeOnFocusOut:!0,devMode:!1,display:null,onClose:null,onOpen:null,opened:!1,options:{},placeholder:null,startingTabIndex:0},u||{}),o.options.options[l]&&(o.options=Object.assign(o.options,o.options.options[l])),delete o.options.options;var e=o.getAttribute("data-vanishing-field-apply-styles");e&&(o.options.applyStyles="false"!==e);e=o.getAttribute("data-vanishing-field-close-on-focus-out");e&&(o.options.closeOnFocusOut="false"!==e),o.label&&(o.label.display=o.label.getAttribute("data-vanishing-field-display")||o.options.display,o.label.placeholder=o.label.getAttribute("data-vanishing-field-placeholder")||o.options.placeholder,!1===o.options.startingTabIndex||o.label.getAttribute("tabindex")||o.label.setAttribute("tabindex",o.options.startingTabIndex+p)),!1===o.options.startingTabIndex||o.getAttribute("tabindex")||(o.setAttribute("tabindex",o.options.startingTabIndex+p),c.lastTabIndex=o.options.startingTabIndex+p),o.open=function(e){return o.options.devMode&&console.log(l,"open"),!0===o.opened||(o.opened=!0,o.options.applyStyles&&(o.style.display=null,o.style.visibility=null,o.label&&(o.label.style.display="none",o.label.style.visibility="hidden")),o.classList.toggle("open",o.opened),o.label&&o.label.classList.toggle("open",o.opened),(o.inputs.length?o.inputs[0]:o).focus(),!1!==e&&o.dispatchEvent(new Event("open",{bubbles:!0}))),o},o.close=function(e){if(o.options.devMode&&console.log(l,"close"),!1===o.opened)return o;o.opened=!1,o.values=o.getInputValues(),o.options.applyStyles&&(o.style.display="none",o.style.visibility="hidden",o.label&&(o.label.style.display=null,o.label.style.visibility=null));var t,n=Object.values(o.values).filter(function(e){return e&&e.length});for(t in o.changed=!1,o.empty=!n.length,o.values)if(o.values.hasOwnProperty(t))if(Array.isArray(o.values[t])){if(o.values[t].sort().join(",")!==o.originalValues[t].sort().join(",")){o.changed=!0;break}}else if(o.values[t]!==o.originalValues[t]){o.changed=!0;break}return o.classList.toggle("open",o.opened),o.classList.toggle("changed",o.changed),o.classList.toggle("empty",o.empty),o.label&&(o.label.classList.toggle("open",o.opened),o.label.classList.toggle("changed",o.changed),o.label.classList.toggle("empty",o.empty),o.empty?o.label.placeholder?"function"==typeof o.label.placeholder?o.label.innerHTML=o.label.placeholder(o):o.label.innerHTML=o.label.placeholder:o.label.innerHTML="":o.label.display?"function"==typeof o.label.display?o.label.innerHTML=o.label.display(o):o.label.innerHTML=o.label.display.replace(/{(.+?)}/g,function(e,t){t=t.split("|"),e=o.values[t[0]]||t[1]||e;return e=Array.isArray(e)?e.join(t[2]||","):e}):o.label.innerHTML=n.join(" ")),!1!==e&&o.dispatchEvent(new Event("close",{bubbles:!0})),o},o.toggle=function(e,t){return o.options.devMode&&console.log(l,"toggle"),!0===e||void 0===e&&!o.opened?o.open(t):(!1===e||void 0===e&&o.opened)&&o.close(t),o},o.getInputValues=function(){var e={};return o.inputs.length&&(e=Array.from(o.inputs).reduce(function(e,t){var n=t.name||t.id,o=t.value,l=t.tagName.toLowerCase();if("[]"===n.slice(-2)&&(n=n.substr(0,n.length-2),o=[o]),"select"===l&&t.multiple&&(o=Array.from(t.selectedOptions).map(function(e){return e.value})),"file"===t.type&&(o=Array.from(t.files).map(function(e){return e.name})),("checkbox"===t.type||"radio"===t.type)&&!t.checked){if(e[n])return e;o=Array.isArray(o)?[]:null}return e[n]&&(o=(o=Array.isArray(e[n])?e[n].concat([o]):[e[n],o]).filter(function(e){return e&&e.length})),e[n]=o,e},{})),o.options.devMode&&console.log(l,"input values:",e),e},o.label&&(o.label.addEventListener("click",function(e){e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"label click"),o.open()}),o.label.addEventListener("focusin",function(e){e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"label focusin"),o.open()})),o.addEventListener("focusout",function(e){o.contains(e.relatedTarget)||o.contains(document.activeElement)||(e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"focusout"),o.options.closeOnFocusOut&&o.close())}),o.options.onOpen&&o.addEventListener("open",function(e){e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"onOpen"),o.options.onOpen(e,o)}),o.options.onClose&&o.addEventListener("close",function(e){e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"onClose"),o.options.onClose(e,o)});for(var t=document.querySelectorAll('[data-vanishing-field-open="'+l+'"]'),n=0;n<t.length;n++)!function(t){t.addEventListener("click",function(e){e.target===e.currentTarget&&(e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"openElement click",t),o.open())})}(t[n]);for(var i=document.querySelectorAll('[data-vanishing-field-close="'+l+'"]'),a=0;a<i.length;a++)!function(t){t.addEventListener("click",function(e){e.target===e.currentTarget&&(e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"closeElement click",t),o.close())})}(i[a]);for(var s=document.querySelectorAll('[data-vanishing-field-toggle="'+l+'"]'),r=0;r<s.length;r++)!function(t){t.addEventListener("click",function(e){e.target===e.currentTarget&&(e.stopImmediatePropagation(),o.options.devMode&&console.log(l,"toggleElement click",t),o.toggle())})}(s[r]);for(var d=0;d<o.inputs.length;d++)!function(n){if(n.id)for(var e=document.querySelectorAll("label[for="+n.id+"]"),t=0;t<e.length;t++)!function(t){t.addEventListener("click",function(e){o.options.devMode&&console.log(l,"input label click",t,n),o.open()})}(e[t])}(o.inputs[d]);o.values=o.getInputValues(),o.originalValues=Object.assign({},o.values);e=Object.values(o.values).filter(function(e){return e&&e.length});o.changed=!1,o.empty=!e.length,o.classList.toggle("empty",o.empty),o.label&&o.label.classList.toggle("empty",o.empty),o.classList.contains("open")||o.options.opened?o.open(!1):o.close(!1)}else console.warn(o,"data-vanishing-field attribute needs to be set to a string")}(e[p])},n=0;n<e.length;n++)t(n);return e}});
//# sourceMappingURL=vanishing-fields.min.js.map