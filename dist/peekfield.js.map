{"version":3,"file":"peekfield.js","sources":["../src/peekfield.js"],"sourcesContent":["/*!\n  peekfield v0.2.0 (https://peekfield.js.org)\n  by Kodie Grantham (https://kodieg.com)\n*/\n\nvar peekfield = (options, fields) => {\n  if (!options) options = {}\n  if (!fields) fields = '[data-peekfield]:not(data-peekfield-ignore)'\n\n  if (typeof fields === 'string') {\n    fields = document.querySelectorAll(fields)\n  } else if (fields instanceof HTMLElement) {\n    fields = [fields]\n  }\n\n  if (peekfield.fieldCount === undefined) {\n    peekfield.fieldCount = 0\n    peekfield.lastTabIndex = -1\n  } else {\n    if (!options.startingTabIndex) {\n      options.startingTabIndex = (peekfield.lastTabIndex + 1)\n    }\n  }\n\n  for (let i = 0; i < fields.length; i++) {\n    (function (field) {\n      const identifier = field.getAttribute('data-peekfield')\n\n      if (!identifier.length) {\n        console.warn(field, 'data-peekfield attribute needs to be set to a string')\n        return false\n      }\n\n      peekfield.fieldCount++\n\n      field.label = document.querySelector('[data-peekfield-for=\"' + identifier + '\"]')\n      field.inputs = field.querySelectorAll('input:not(data-peekfield-ignore),textarea:not(data-peekfield-ignore),select:not(data-peekfield-ignore)')\n\n      field.options = Object.assign({\n        applyStyles: true,\n        closeOnFocusOut: true,\n        devMode: false,\n        display: null,\n        onClose: null,\n        onOpen: null,\n        opened: false,\n        options: {},\n        placeholder: null,\n        startingTabIndex: 0\n      }, options || {})\n\n      if (field.options.options[identifier]) {\n        field.options = Object.assign(field.options, field.options.options[identifier])\n      }\n\n      delete field.options.options\n\n      const applyStylesAttr = field.getAttribute('data-peekfield-apply-styles')\n      if (applyStylesAttr) field.options.applyStyles = (applyStylesAttr !== 'false')\n\n      const closeOnFocusOutAttr = field.getAttribute('data-peekfield-close-on-focus-out')\n      if (closeOnFocusOutAttr) field.options.closeOnFocusOut = (closeOnFocusOutAttr !== 'false')\n\n      if (field.label) {\n        field.label.display = field.label.getAttribute('data-peekfield-display') || field.options.display\n        field.label.placeholder = field.label.getAttribute('data-peekfield-placeholder') || field.options.placeholder\n\n        if (field.options.startingTabIndex !== false && !field.label.getAttribute('tabindex')) {\n          field.label.setAttribute('tabindex', field.options.startingTabIndex + i)\n        }\n      }\n\n      if (field.options.startingTabIndex !== false && !field.getAttribute('tabindex')) {\n        field.setAttribute('tabindex', field.options.startingTabIndex + i)\n        peekfield.lastTabIndex = (field.options.startingTabIndex + i)\n      }\n\n      field.open = function (triggerEvents) {\n        if (field.options.devMode) console.log(identifier, 'open')\n        if (field.opened === true) return field\n\n        field.opened = true\n\n        if (field.options.applyStyles) {\n          field.style['display'] = null\n          field.style['visibility'] = null\n\n          if (field.label) {\n            field.label.style['display'] = 'none'\n            field.label.style['visibility'] = 'hidden'\n          }\n        }\n\n        field.classList.toggle('open', field.opened)\n        if (field.label) field.label.classList.toggle('open', field.opened)\n\n        if (field.inputs.length) {\n          field.inputs[0].focus()\n        } else {\n          field.focus()\n        }\n\n        if (triggerEvents !== false) {\n          field.dispatchEvent(new Event('open', { bubbles: true }))\n        }\n\n        return field\n      }\n\n      field.close = function (triggerEvents) {\n        if (field.options.devMode) console.log(identifier, 'close')\n        if (field.opened === false) return field\n\n        field.opened = false\n        field.values = field.getInputValues()\n\n        if (field.options.applyStyles) {\n          field.style['display'] = 'none'\n          field.style['visibility'] = 'hidden'\n\n          if (field.label) {\n            field.label.style['display'] = null\n            field.label.style['visibility'] = null\n          }\n        }\n\n        const inputValues = Object.values(field.values).filter(function (v) { return v && v.length })\n\n        field.changed = false\n        field.empty = !inputValues.length\n\n        for (const name in field.values) {\n          if (field.values.hasOwnProperty(name)) {\n            if (Array.isArray(field.values[name])) {\n              if (field.values[name].sort().join(',') !== field.originalValues[name].sort().join(',')) {\n                field.changed = true\n                break\n              }\n            } else {\n              if (field.values[name] !== field.originalValues[name]) {\n                field.changed = true\n                break\n              }\n            }\n          }\n        }\n\n        field.classList.toggle('open', field.opened)\n        field.classList.toggle('changed', field.changed)\n        field.classList.toggle('empty', field.empty)\n\n        if (field.label) {\n          field.label.classList.toggle('open', field.opened)\n          field.label.classList.toggle('changed', field.changed)\n          field.label.classList.toggle('empty', field.empty)\n\n          if (field.empty) {\n            if (field.label.placeholder) {\n              if (typeof field.label.placeholder === 'function') {\n                field.label.innerHTML = field.label.placeholder(field)\n              } else {\n                field.label.innerHTML = field.label.placeholder\n              }\n            } else {\n              field.label.innerHTML = ''\n            }\n          } else {\n            if (field.label.display) {\n              if (typeof field.label.display === 'function') {\n                field.label.innerHTML = field.label.display(field)\n              } else {\n                field.label.innerHTML = field.label.display.replace(/{(.+?)}/g, function (match, name) {\n                  const split = name.split('|')\n                  let value = field.values[split[0]] || split[1] || match\n                  if (Array.isArray(value)) value = value.join(split[2] || ',')\n                  return value\n                })\n              }\n            } else {\n              field.label.innerHTML = inputValues.join(' ')\n            }\n          }\n        }\n\n        if (triggerEvents !== false) {\n          field.dispatchEvent(new Event('close', { bubbles: true }))\n        }\n\n        return field\n      }\n\n      field.toggle = (open, triggerEvents) => {\n        if (field.options.devMode) console.log(identifier, 'toggle')\n\n        if (open === true || (open === undefined && !field.opened)) {\n          field.open(triggerEvents)\n        } else if (open === false || (open === undefined && field.opened)) {\n          field.close(triggerEvents)\n        }\n\n        return field\n      }\n\n      field.getInputValues = () => {\n        let values = {}\n\n        if (field.inputs.length) {\n          values = Array.from(field.inputs).reduce((values, input) => {\n            let name = input.name || input.id\n            let value = input.value\n            const tagName = input.tagName.toLowerCase()\n\n            if (name.slice(-2) === '[]') {\n              name = name.substr(0, name.length - 2)\n              value = [value]\n            }\n\n            if (tagName === 'select' && input.multiple) {\n              value = Array.from(input.selectedOptions).map(function (option) {\n                return option.value\n              })\n            }\n\n            if (input.type === 'file') {\n              value = Array.from(input.files).map(function (file) {\n                return file.name\n              })\n            }\n\n            if ((input.type === 'checkbox' || input.type === 'radio') && !input.checked) {\n              if (values[name]) return values\n              value = Array.isArray(value) ? [] : null\n            }\n\n            if (values[name]) {\n              if (Array.isArray(values[name])) {\n                value = values[name].concat([value])\n              } else {\n                value = [values[name], value]\n              }\n\n              value = value.filter((v) => v && v.length)\n            }\n\n            values[name] = value\n            return values\n          }, {})\n        }\n\n        if (field.options.devMode) console.log(identifier, 'input values:', values)\n\n        return values\n      }\n\n      if (field.label) {\n        field.label.addEventListener('click', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'label click')\n          field.open()\n        })\n\n        field.label.addEventListener('focusin', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'label focusin')\n          field.open()\n        })\n      }\n\n      field.addEventListener('focusout', function (e) {\n        if (field.contains(e.relatedTarget) || field.contains(document.activeElement)) return\n        e.stopImmediatePropagation()\n        if (field.options.devMode) console.log(identifier, 'focusout')\n        if (field.options.closeOnFocusOut) field.close()\n      })\n\n      if (field.options.onOpen) {\n        field.addEventListener('open', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'onOpen')\n          field.options.onOpen(e, field)\n        })\n      }\n\n      if (field.options.onClose) {\n        field.addEventListener('close', function (e) {\n          e.stopImmediatePropagation()\n          if (field.options.devMode) console.log(identifier, 'onClose')\n          field.options.onClose(e, field)\n        })\n      }\n\n      const openElements = document.querySelectorAll('[data-peekfield-open=\"' + identifier + '\"]')\n      for (let j1 = 0; j1 < openElements.length; j1++) {\n        (function (openElement) {\n          openElement.addEventListener('click', function (e) {\n            if (e.target !== e.currentTarget) return\n            e.stopImmediatePropagation()\n            if (field.options.devMode) console.log(identifier, 'openElement click', openElement)\n            field.open()\n          })\n        })(openElements[j1])\n      }\n\n      const closeElements = document.querySelectorAll('[data-peekfield-close=\"' + identifier + '\"]')\n      for (let j2 = 0; j2 < closeElements.length; j2++) {\n        (function (closeElement) {\n          closeElement.addEventListener('click', function (e) {\n            if (e.target !== e.currentTarget) return\n            e.stopImmediatePropagation()\n            if (field.options.devMode) console.log(identifier, 'closeElement click', closeElement)\n            field.close()\n          })\n        })(closeElements[j2])\n      }\n\n      const toggleElements = document.querySelectorAll('[data-peekfield-toggle=\"' + identifier + '\"]')\n      for (let j3 = 0; j3 < toggleElements.length; j3++) {\n        (function (toggleElement) {\n          toggleElement.addEventListener('click', function (e) {\n            if (e.target !== e.currentTarget) return\n            e.stopImmediatePropagation()\n            if (field.options.devMode) console.log(identifier, 'toggleElement click', toggleElement)\n            field.toggle()\n          })\n        })(toggleElements[j3])\n      }\n\n      for (let j4 = 0; j4 < field.inputs.length; j4++) {\n        (function (input) {\n          if (input.id) {\n            const inputLabels = document.querySelectorAll('label[for=' + input.id + ']')\n            for (let j4i = 0; j4i < inputLabels.length; j4i++) {\n              (function (inputLabel) {\n                inputLabel.addEventListener('click', function (e) {\n                  if (field.options.devMode) console.log(identifier, 'input label click', inputLabel, input)\n                  field.open()\n                })\n              })(inputLabels[j4i])\n            }\n          }\n        })(field.inputs[j4])\n      }\n\n      field.values = field.getInputValues()\n      field.originalValues = Object.assign({}, field.values)\n\n      const inputValues = Object.values(field.values).filter(function (v) { return v && v.length })\n\n      field.changed = false\n      field.empty = !inputValues.length\n\n      field.classList.toggle('empty', field.empty)\n      if (field.label) field.label.classList.toggle('empty', field.empty)\n\n      if (field.classList.contains('open') || field.options.opened) {\n        field.open(false)\n      } else {\n        field.close(false)\n      }\n    })(fields[i])\n  }\n\n  return fields\n}\n\nexport default peekfield\n"],"names":["peekfield","options","fields","document","querySelectorAll","HTMLElement","fieldCount","undefined","lastTabIndex","startingTabIndex","_loop","i","field","identifier","getAttribute","length","console","warn","label","querySelector","inputs","Object","assign","applyStyles","closeOnFocusOut","devMode","display","onClose","onOpen","opened","placeholder","applyStylesAttr","closeOnFocusOutAttr","setAttribute","open","triggerEvents","log","style","classList","toggle","focus","dispatchEvent","Event","bubbles","close","values","getInputValues","inputValues","filter","v","changed","empty","name","hasOwnProperty","Array","isArray","sort","join","originalValues","innerHTML","replace","match","split","value","from","reduce","input","id","tagName","toLowerCase","slice","substr","multiple","selectedOptions","map","option","type","files","file","checked","concat","addEventListener","e","stopImmediatePropagation","contains","relatedTarget","activeElement","openElements","j1","openElement","target","currentTarget","closeElements","j2","closeElement","toggleElements","j3","toggleElement","j4","inputLabels","j4i","inputLabel"],"mappings":"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"}